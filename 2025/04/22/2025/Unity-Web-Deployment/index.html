
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Unity Web Deployment | LunarEclipse&#39;s Home</title>
    <meta name="author" content="Lunar Eclipse" />
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <meta
        name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"
    />
    <link rel="icon" href="/images/avatar.png" />
    <link rel="preconnect" href="https://s4.zstatic.net" />
<script src="https://s4.zstatic.net/ajax/libs/vue/3.3.7/vue.global.prod.min.js"></script>
<link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
<link rel="preconnect" href="https://fonts.googleapis.cn" />
<link rel="preconnect" href="https://fonts.gstatic.cn" crossorigin />
<link
    rel="stylesheet"
    href="https://fonts.googleapis.cn/css2?family=Fira+Code:wght@400;500;600;700&family=Lexend:wght@400;500;600;700;800;900&family=Noto+Sans+SC:wght@400;500;600;700;800;900&display=swap"
/>
<script> const mixins = {}; </script>

<script src="https://polyfill.alicdn.com/v3/polyfill.min.js?features=default"></script>


<script src="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://s4.zstatic.net/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script>
<link
    rel="stylesheet"
    href="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/styles/github.min.css"
/>
<script src="/js/lib/highlight.js"></script>



<script src="/js/lib/preview.js"></script>





<script src="https://s4.zstatic.net/ajax/libs/gitalk/1.8.0/gitalk.min.js"></script>
<link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/gitalk/1.8.0/gitalk.min.css" />





<link rel="stylesheet" href="/css/main.css" />


<!-- Custom -->

<link rel="stylesheet" href="/css/custom.css" />
<!-- <script src="/js/custom.js"></script> -->

<script src="https://cdn.staticfile.org/animejs/3.2.1/anime.min.js"></script>
<canvas id="fireworks" style="position:fixed;top:0;left:0;width:100vw;height:100vh;pointer-events:none;z-index:2147483647"></canvas>
<script src="/js/fireworks.js"></script>
<canvas id="background" style="position:fixed;top:0;left:0;width:100vw;height:100vh;pointer-events:none;z-index:-1"></canvas>
<script src="/js/background.js"></script>
<script src="/js/pocket.gl.min.js"></script>


<script src="https://unpkg.com/@highlightjs/cdn-assets@11.11.1/languages/dart.min.js"></script>
<script src="https://unpkg.com/@highlightjs/cdn-assets@11.11.1/languages/gdscript.min.js"></script>
<script>hljs.registerLanguage("gdscript",function(){"use strict";var e=e||{};function r(e){return{aliases:["godot","gdscript"],keywords:{keyword:"and in not or self void as assert breakpoint class class_name extends is func setget signal tool yield const enum export onready static var break continue if elif else for pass return match while remote sync master puppet remotesync mastersync puppetsync",built_in:"Color8 ColorN abs acos asin atan atan2 bytes2var cartesian2polar ceil char clamp convert cos cosh db2linear decimals dectime deg2rad dict2inst ease exp floor fmod fposmod funcref get_stack hash inst2dict instance_from_id inverse_lerp is_equal_approx is_inf is_instance_valid is_nan is_zero_approx len lerp lerp_angle linear2db load log max min move_toward nearest_po2 ord parse_json polar2cartesian posmod pow preload print_stack push_error push_warning rad2deg rand_range rand_seed randf randi randomize range_lerp round seed sign sin sinh smoothstep sqrt step_decimals stepify str str2var tan tanh to_json type_exists typeof validate_json var2bytes var2str weakref wrapf wrapi bool int float String NodePath Vector2 Rect2 Transform2D Vector3 Rect3 Plane Quat Basis Transform Color RID Object NodePath Dictionary Array PoolByteArray PoolIntArray PoolRealArray PoolStringArray PoolVector2Array PoolVector3Array PoolColorArray",literal:"true false null"},contains:[e.NUMBER_MODE,e.HASH_COMMENT_MODE,{className:"comment",begin:/"""/,end:/"""/},e.QUOTE_STRING_MODE,{variants:[{className:"function",beginKeywords:"func"},{className:"class",beginKeywords:"class"}],end:/:/,contains:[e.UNDERSCORE_TITLE_MODE]}]}}return e.exports=function(e){e.registerLanguage("gdscript",r)},e.exports.definer=r,e.exports.definer||e.exports}());</script>

<meta name="generator" content="Hexo 6.3.0"></head>
<body>
    <div id="layout">
        <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>加载过慢请开启缓存 浏览器默认开启</p>
                    <img src="/images/loading.gif" />
                </div>
            </div>
        </transition>
        <div id="menu" :class="{ hidden: hiddenMenu, 'menu-color': menuColor}">
    <nav id="desktop-menu">
        <a class="title" href="/">
            <span>LUNARECLIPSE&#39;S HOME</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;Categories</span>
        </a>
        
        <a href="/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
    </nav>
    <nav id="mobile-menu">
        <div class="title" @click="showMenuItems = !showMenuItems">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;LUNARECLIPSE&#39;S HOME</span>
        </div>
        <transition name="slide">
            <div class="items" v-show="showMenuItems">
                
                <a href="/">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-house fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                    </div>
                </a>
                
                <a href="/about">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-id-card fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                    </div>
                </a>
                
                <a href="/archives">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-box-archive fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                    </div>
                </a>
                
                <a href="/categories">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-bookmark fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Categories</div>
                    </div>
                </a>
                
                <a href="/tags">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-tags fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                    </div>
                </a>
                
            </div>
        </transition>
    </nav>
</div>
<transition name="fade">
    <div id="menu-curtain" @click="showMenuItems = !showMenuItems" v-show="showMenuItems"></div>
</transition>

        <div id="main" :class="loading ? 'into-enter-from': 'into-enter-active'">
            <div class="article">
    <div>
        <h1>Unity Web Deployment</h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2025/4/22
        </span>
        
        
        <span class="tags">
            <span class="icon">
                <i class="fa-solid fa-tags fa-fw"></i>
            </span>
            
            
            <span class="tag">
                
                <a href="/tags/Unity/" style="color: #ffa2c4">
                    Unity
                </a>
            </span>
            
        </span>
        
    </div>
    
    <div class="content" v-pre>
        <iframe width="100%" id="game" src="https://www.lunareclipse.cc/WebGenshin/" scrolling="no" frameBorder="0" allowfullscreen style="aspect-ratio: 16/9; width: 100%;"></iframe>

<h2 id="目録"><a href="#目録" class="headerlink" title="目録"></a>目録</h2><ul>
<li><a href="#%E7%9B%AE%E9%8C%B2">目録</a></li>
<li><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB">はじめに</a></li>
<li><a href="#%E3%82%B2%E3%83%BC%E3%83%A0%E3%82%92%E3%82%A8%E3%82%AF%E3%82%B9%E3%83%9D%E3%83%BC%E3%83%88">ゲームをエクスポート</a></li>
<li><a href="#%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4">デプロイ</a><ul>
<li><a href="#streamingassets">StreamingAssets</a><ul>
<li><a href="#cors-%E5%95%8F%E9%A1%8C">CORS 問題</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#javascript-%E3%81%A8%E9%80%9A%E4%BF%A1">JavaScript と通信</a><ul>
<li><a href="#javascript-%E5%81%B4">JavaScript 側</a><ul>
<li><a href="#c-%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%99">C# コードを呼び出す</a></li>
</ul>
</li>
<li><a href="#unity-%E5%81%B4">Unity 側</a></li>
</ul>
</li>
</ul>
<h2 id="はじめに"><a href="#はじめに" class="headerlink" title="はじめに"></a>はじめに</h2><h2 id="ゲームをエクスポート"><a href="#ゲームをエクスポート" class="headerlink" title="ゲームをエクスポート"></a>ゲームをエクスポート</h2><h2 id="デプロイ"><a href="#デプロイ" class="headerlink" title="デプロイ"></a>デプロイ</h2><h3 id="StreamingAssets"><a href="#StreamingAssets" class="headerlink" title="StreamingAssets"></a>StreamingAssets</h3><h4 id="CORS-問題"><a href="#CORS-問題" class="headerlink" title="CORS 問題"></a>CORS 問題</h4><p><font color="#d83931">webgl has been blocked by CORS policy: No ‘Access-Control-Allow-Origin’</font></p>
<p>以 Node.js 的 <a target="_blank" rel="noopener" href="https://github.com/http-party/http-server">http-server</a> 为例需要在命令后面加上 <code>--cors</code> 选项：</p>
<pre><code class="bash">npx http-server --cors
</code></pre>
<p>以 <a target="_blank" rel="noopener" href="https://github.com/honojs/hono">Hono</a> 库为例</p>
<pre><code class="ts">const app = new Hono&lt;&#123; Bindings: Bindings &#125;&gt;()
app.use(&#39;*&#39;, cors())
</code></pre>
<h2 id="JavaScript-と通信"><a href="#JavaScript-と通信" class="headerlink" title="JavaScript と通信"></a>JavaScript と通信</h2><h3 id="JavaScript-側"><a href="#JavaScript-側" class="headerlink" title="JavaScript 側"></a>JavaScript 側</h3><h5 id="C-コードを呼び出す"><a href="#C-コードを呼び出す" class="headerlink" title="C# コードを呼び出す"></a>C# コードを呼び出す</h5><p>JavaScript 側で C# コードを呼び出すために、Unity を代表するインスタンスをグローバルスコープに公開する必要があります。<br><code>index.html</code> で <code>createUnityInstance</code> という関数を使用して、Unity インスタンスを獲得し、<code>unity</code> という名前のグローバルオブジェクトを作成します。</p>
<pre><code class="js">var script = document.createElement(&quot;script&quot;);
script.src = loaderUrl;
script.onload = () =&gt; &#123;
  createUnityInstance(canvas, config, (progress) =&gt; &#123;
    progressBarFull.style.width = 100 * progress + &quot;%&quot;;
  &#125;).then((unityInstance) =&gt; &#123;
    unity = unityInstance; // &lt;----
    loadingBar.style.display = &quot;none&quot;;
  &#125;).catch((message) =&gt; &#123;
    alert(message);
  &#125;);
&#125;;
</code></pre>
<p>これで、<code>SendMessage(objectName, methodName, value)</code> 方法を使用して、どこでも C# コードを呼び出すことができます。</p>
<pre><code class="js">unity.SendMessage(&#39;MyGameObject&#39;, &#39;MyFunction&#39;);
unity.SendMessage(&#39;MyGameObject&#39;, &#39;MyFunction&#39;, 5);
unity.SendMessage(&#39;MyGameObject&#39;, &#39;MyFunction&#39;, &#39;MyString&#39;);
</code></pre>
<blockquote>
<p>注意：<code>SendMessage</code> で呼び出す関数は、以下の制限があります：</p>
<ul>
<li>関数の引数の数は 0 または 1 でなければなりません。</li>
<li>関数の引数は、<code>string</code> と数字のいずれかでなければなりません。</li>
</ul>
</blockquote>
<h3 id="Unity-側"><a href="#Unity-側" class="headerlink" title="Unity 側"></a>Unity 側</h3><p><code>bridge.jslib</code> というファイルを作成して、JavaScript 側の関数を定義します。</p>
<pre><code class="js">mergeInto(LibraryManager.library, &#123;  
  Hello: function () &#123;  
    alert(&quot;Hello, world!&quot;)  
  &#125;,  
  AddNumbers: function (x, y) &#123;  
    return x + y;  
  &#125;,  
  Echo: function (str) &#123;  
    var jsstr = UTF8ToString(str)  
    var bufferSize = lengthBytesUTF8(jsstr) + 1;  
    return stringToUTF8(jsstr, _malloc(bufferSize), bufferSize);  
  &#125;,  
  PrintArray: function (array, size) &#123;  
    for(var i = 0; i &lt; size; i++)  
        console.log(HEAPF32[(array &gt;&gt; 2) + i]);  
  &#125;,  
&#125;);
</code></pre>
<pre><code class="cs">public class WebGLBridge 
&#123;  
    [DllImport(&quot;__Internal&quot;)] public static extern void Hello();  
    [DllImport(&quot;__Internal&quot;)] public static extern int Add(int x, int y);  
    [DllImport(&quot;__Internal&quot;)] public static extern string Echo(string str);  
    [DllImport(&quot;__Internal&quot;)] public static extern void PrintArray(float[] array, int size);  
&#125;
</code></pre>
<p><a target="_blank" rel="noopener" href="https://hono.dev/docs/middleware/builtin/cors">CORS Middleware - Hono</a></p>
<p><a target="_blank" rel="noopener" href="https://note.com/npaka/n/nca1e35a649e3">Unity(WebGL)のC#とブラウザのJavaScriptの連携｜npaka</a><br><a target="_blank" rel="noopener" href="https://zenn.dev/happy_elements/articles/hekk_ac_20231215">Unity 製 WebGL ゲームを AWS でお手軽公開</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/votetake/vue-unity-webgl">GitHub - votetake&#x2F;vue-unity-webgl: Unity 3d Component for VueJS</a></p>

    </div>
    
    
    
    <div id="comment">
        <div id="gitalk-container"></div>
    </div>
    
    
    
    
    
</div>

            <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2022 - 2025 LunarEclipse&#39;s Home
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;Lunar Eclipse
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/theme-particlex/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

        </div>
        
        <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
        </transition>
        
    </div>
    <script src="/js/main.js"></script>
    
    

<script>
    console.log("gitalk path: ", decodeURI(location.pathname).substring(0, 50));
    const gitalk = new Gitalk({
        clientID: "1b257199da39cd021fa4",
        clientSecret: "03478a1dd851368fe32a4eea9483c00ce041e3a2",
        repo: "949886.github.io",
        owner: "949886",
        admin: "949886".split(","),
        language: "en",
        id: decodeURI(location.pathname),
        
    })
    gitalk.render("gitalk-container");
</script>




    
</body>
</html>
